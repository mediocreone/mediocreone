<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="FooBar CTF 2021 notes" /><meta name="author" content="mediocre_one" /><meta property="og:locale" content="en_US" /><meta name="description" content="FooBar CTF 2021 notes" /><meta property="og:description" content="FooBar CTF 2021 notes" /><link rel="canonical" href="mediocreone.com/2021/04/02/foobar-ctf-2021" /><meta property="og:url" content="mediocreone.com/2021/04/02/foobar-ctf-2021" /><meta property="og:site_name" content="Just a blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-02T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="FooBar CTF 2021 notes" /><meta name="twitter:site" content="@mediocre_one" /><meta name="twitter:creator" content="@mediocre_one" /> <script type="application/ld+json"> {"description":"FooBar CTF 2021 notes","@type":"BlogPosting","url":"mediocreone.com/2021/04/02/foobar-ctf-2021","headline":"FooBar CTF 2021 notes","dateModified":"2021-04-02T00:00:00+00:00","datePublished":"2021-04-02T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"mediocreone.com/2021/04/02/foobar-ctf-2021"},"author":{"@type":"Person","name":"mediocre_one"},"@context":"https://schema.org"}</script><title> FooBar CTF 2021 notes - Just a blog</title><link rel="shortcut icon" href="/favicon.png"><link rel="alternate" type="application/atom+xml" title="Just a blog" href="/atom.xml"><link rel="alternate" type="application/json" title="Just a blog" href="mediocreone.com/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><style> .highlight .hll{background-color:#ffffcc}.highlight .c{color:#808080}.highlight .err{color:#F00000;background-color:#F0A0A0}.highlight .k{color:#008000;font-weight:bold}.highlight .o{color:#303030}.highlight .cm{color:#808080}.highlight .cp{color:#507090}.highlight .c1{color:#808080}.highlight .cs{color:#cc0000;font-weight:bold}.highlight .gd{color:#A00000}.highlight .ge{font-style:italic}.highlight .gr{color:#FF0000}.highlight .gh{color:#000080;font-weight:bold}.highlight .gi{color:#00A000}.highlight .go{color:#808080}.highlight .gp{color:#c65d09;font-weight:bold}.highlight .gs{font-weight:bold}.highlight .gu{color:#800080;font-weight:bold}.highlight .gt{color:#0040D0}.highlight .kc,.highlight .kd,.highlight .kn{color:#008000;font-weight:bold}.highlight .kp{color:#003080;font-weight:bold}.highlight .kr{color:#008000;font-weight:bold}.highlight .kt{color:#303090;font-weight:bold}.highlight .m{color:#6000E0;font-weight:bold}.highlight .s{background-color:#fff0f0}.highlight .na{color:#0000C0}.highlight .nb{color:#007020}.highlight .nc{color:#B00060;font-weight:bold}.highlight .no{color:#003060;font-weight:bold}.highlight .nd{color:#505050;font-weight:bold}.highlight .ni{color:#800000;font-weight:bold}.highlight .ne{color:#F00000;font-weight:bold}.highlight .nf{color:#0060B0;font-weight:bold}.highlight .nl{color:#907000;font-weight:bold}.highlight .nn{color:#0e84b5;font-weight:bold}.highlight .nt{color:#007000}.highlight .nv{color:#906030}.highlight .ow{color:#000000;font-weight:bold}.highlight .w{color:#bbbbbb}.highlight .mf{color:#6000E0;font-weight:bold}.highlight .mh{color:#005080;font-weight:bold}.highlight .mi{color:#0000D0;font-weight:bold}.highlight .mo{color:#4000E0;font-weight:bold}.highlight .sb{background-color:#fff0f0}.highlight .sc{color:#0040D0}.highlight .sd{color:#D04020}.highlight .s2{background-color:#fff0f0}.highlight .se{color:#606060;font-weight:bold;background-color:#fff0f0}.highlight .sh{background-color:#fff0f0}.highlight .si{background-color:#e0e0e0}.highlight .sx{color:#D02000;background-color:#fff0f0}.highlight .sr{color:#000000;background-color:#fff0ff}.highlight .s1{background-color:#fff0f0}.highlight .ss{color:#A06000}.highlight .bp{color:#007020}.highlight .vc{color:#306090}.highlight .vg{color:#d07000;font-weight:bold}.highlight .vi{color:#3030B0}.highlight .il{color:#0000D0;font-weight:bold}*,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:0.5rem 0;padding:0.5rem}.post p{margin:0.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:0.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:0.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:0.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:75rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}.right1,.networth dd span,.networth .total span,.networth .total small,.networth .expiration .note{float:right;margin-right:1em}.networth{margin-top:40px;border-right:1px solid #edf2f7}.networth dt,.networth .date{text-align:right;margin-right:2rem}.networth .total{margin-top:20px;padding-bottom:20px}.expiration{margin-top:30px}.coffee{position:fixed;bottom:18px}.language-nasm .highlight .err{color:inherit;background-color:inherit}.language-bash .highlight .err{color:inherit;background-color:inherit}.language-posh .highlight .err{color:inherit;background-color:inherit}</style></head><body><main role="main"><header role="banner"> <!--<h1 class="logo">Just a blog</h1>--><nav role="navigation"><ul><li><a href="/" >Writing</a></li><li><a href="/about" >About</a></li><li><a href="/search" >Search</a></li><li><a href="/atom.xml" >Rss</a></li></ul></nav><div class="networth"><dl><dt><u>Assets</u></dt><dd>- home <span class="amount">18.0k</span></dd><dd>- device(s) <span class="amount">1.0k</span></dd><dd>- stock(s) <span class="amount">2.0k</span></dd><dd>- server <span class="amount">0.1k</span></dd><dd>- cash <span class="amount">0.1k</span></dd><dt><u>Liabilities</u></dt><dd>- debt <span class="amount">4.0k</span></dd><dd>- loan <span class="amount">0.0k</span></dd></dl><div class="total"> <b><span>My Net: 17.2k</span></b> </br> <small>03-31-2021</small></div></div><script> const format = (x) => (x < 10) ? "0" + x : x; setInterval(() => { let delta = (new Date("2055/12/31") - new Date()) / 1000; const days = delta / 86400 | 0; document.getElementById('days').innerHTML = days; delta -= days * 86400; const hours = (delta / 3600 | 0) % 24; document.getElementById('hours').innerHTML = format(hours); delta -= hours * 3600; const minutes = (delta / 60 | 0) % 60; document.getElementById('mins').innerHTML = `:${format(minutes)}:`; delta -= minutes * 60; document.getElementById('secs').innerHTML = format((delta % 60) | 0); }, 1000); </script><div class="expiration"> <span class="right1">Expired by:</span></br> <span class="right1"> <span id="days"></span> <span id="hours"></span><span id="mins"></span><span id="secs"></span> </span></div></header><section class="post"><h2>FooBar CTF 2021 notes</h2><p>The FooBar 2021 was held by people from NIT Durgapur University. I hoped the event to be beginner friendly. When it comes down to assembler, reversing and binary exploitation, etc, I simply go blind. So this time around, I visited the Underworld to meet some baby monsters.</p><h3 id="1-net_dot-reverse">1. <a id="net_dot" style="text-decoration:none;">NET_DOT [reverse]</a></h3><p>The challenge statement:</p><blockquote><p>Find the flag…<br /> Author: kaki-epithesi<br /> File: <a href="/assets/img/foobar/win.zip">win.dll</a></p></blockquote><p>We have a dynamic-link library file written in the .NET framework. My quick search shortlisted: JetBrains <a href="https://www.jetbrains.com/decompiler/">dotPeek</a>, Telerik <a href="https://www.telerik.com/products/decompiler.aspx">JustDecompile</a>, and <a href="https://github.com/icsharpcode/ILSpy">ILSpy</a>. The <code class="language-plaintext highlighter-rouge">dotPeek</code> extracted the following C# code with ease.</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Decompiled with JetBrains decompiler</span>
<span class="c1">// Assembly: win, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null</span>

<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">win</span>
<span class="p">{</span>
  <span class="k">internal</span> <span class="k">class</span> <span class="nc">Program</span>
  <span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="kt">int</span> <span class="nf">sum_all</span><span class="p">(</span><span class="kt">string</span> <span class="n">password</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">int</span> <span class="n">num</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="kt">char</span> <span class="n">ch</span> <span class="k">in</span> <span class="n">password</span><span class="p">)</span>
        <span class="n">num</span> <span class="p">+=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">ch</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">num</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="kt">int</span> <span class="nf">check</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">values</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">int</span><span class="p">[]</span> <span class="n">numArray</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">26</span><span class="p">]</span>
      <span class="p">{</span>
        <span class="m">2410</span><span class="p">,</span> <span class="m">2404</span><span class="p">,</span> <span class="m">2430</span><span class="p">,</span> <span class="m">2408</span><span class="p">,</span> <span class="m">2391</span><span class="p">,</span> <span class="m">2381</span><span class="p">,</span> <span class="m">2333</span><span class="p">,</span> <span class="m">2396</span><span class="p">,</span> <span class="m">2369</span><span class="p">,</span> <span class="m">2332</span><span class="p">,</span> <span class="m">2398</span><span class="p">,</span> <span class="m">2422</span><span class="p">,</span> <span class="m">2332</span><span class="p">,</span> 
        <span class="m">2397</span><span class="p">,</span> <span class="m">2416</span><span class="p">,</span> <span class="m">2370</span><span class="p">,</span> <span class="m">2393</span><span class="p">,</span> <span class="m">2304</span><span class="p">,</span> <span class="m">2393</span><span class="p">,</span> <span class="m">2333</span><span class="p">,</span> <span class="m">2416</span><span class="p">,</span> <span class="m">2376</span><span class="p">,</span> <span class="m">2371</span><span class="p">,</span> <span class="m">2305</span><span class="p">,</span> <span class="m">2377</span><span class="p">,</span> <span class="m">2391</span>
      <span class="p">};</span>
      <span class="kt">int</span> <span class="n">num</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">index</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">index</span> <span class="p">&lt;</span> <span class="n">numArray</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="p">++</span><span class="n">index</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">numArray</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">==</span> <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="p">{</span>
          <span class="n">num</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
          <span class="n">num</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">num</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Hello there mate \nJust enter the flag to check : "</span><span class="p">);</span>
      <span class="kt">string</span> <span class="n">password</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
      <span class="kt">int</span><span class="p">[]</span> <span class="n">numArray</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">26</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">password</span><span class="p">.</span><span class="n">Length</span> <span class="p">!=</span> <span class="m">26</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Input length error"</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">index</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">index</span> <span class="p">&lt;</span> <span class="n">password</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="p">++</span><span class="n">index</span><span class="p">)</span>
          <span class="n">numArray</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">password</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
        <span class="kt">int</span><span class="p">[]</span> <span class="n">values</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">26</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">index</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">index</span> <span class="p">&lt;</span> <span class="m">26</span><span class="p">;</span> <span class="p">++</span><span class="n">index</span><span class="p">)</span>
          <span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="n">numArray</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">-</span> <span class="p">(</span><span class="n">index</span><span class="p">%</span><span class="m">2</span><span class="p">*</span><span class="m">2</span> <span class="p">+</span> <span class="n">index</span><span class="p">%</span><span class="m">3</span><span class="p">)</span> <span class="p">^</span> <span class="n">Program</span><span class="p">.</span><span class="nf">sum_all</span><span class="p">(</span><span class="n">password</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Program</span><span class="p">.</span><span class="nf">check</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Your flag : "</span> <span class="p">+</span> <span class="n">password</span><span class="p">);</span>
          <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
          <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"try harder"</span><span class="p">);</span>
          <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>By looking at this code, it is clear that we can simply reverse the logic and reconstruct the correct flag representation.</p><div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Reverse</span>
<span class="p">{</span>
  <span class="k">class</span> <span class="nc">Program</span>
  <span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// correct flag syntax ~ "GLUG{...}";</span>
      <span class="c1">// values[index] = numArray[index] - (index % 2 * 2 + index % 3) ^ Program.sum_all(password);</span>
      <span class="c1">// 2410 = (int) 'G' ^ passwordSum [when the index is 0]</span>
      <span class="kt">int</span> <span class="n">passwordSum</span> <span class="p">=</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="sc">'G'</span> <span class="p">^</span> <span class="m">2410</span><span class="p">);</span>
      <span class="kt">int</span><span class="p">[]</span> <span class="n">numArray</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">26</span><span class="p">];</span>
      <span class="kt">int</span><span class="p">[]</span> <span class="n">values</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">26</span><span class="p">]</span>
      <span class="p">{</span> 
        <span class="m">2410</span><span class="p">,</span> <span class="m">2404</span><span class="p">,</span> <span class="m">2430</span><span class="p">,</span> <span class="m">2408</span><span class="p">,</span> <span class="m">2391</span><span class="p">,</span> <span class="m">2381</span><span class="p">,</span> <span class="m">2333</span><span class="p">,</span> <span class="m">2396</span><span class="p">,</span> <span class="m">2369</span><span class="p">,</span> <span class="m">2332</span><span class="p">,</span> <span class="m">2398</span><span class="p">,</span> <span class="m">2422</span><span class="p">,</span> <span class="m">2332</span><span class="p">,</span>
        <span class="m">2397</span><span class="p">,</span> <span class="m">2416</span><span class="p">,</span> <span class="m">2370</span><span class="p">,</span> <span class="m">2393</span><span class="p">,</span> <span class="m">2304</span><span class="p">,</span> <span class="m">2393</span><span class="p">,</span> <span class="m">2333</span><span class="p">,</span> <span class="m">2416</span><span class="p">,</span> <span class="m">2376</span><span class="p">,</span> <span class="m">2371</span><span class="p">,</span> <span class="m">2305</span><span class="p">,</span> <span class="m">2377</span><span class="p">,</span> <span class="m">2391</span> 
      <span class="p">};</span>

      <span class="kt">string</span> <span class="n">flag</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">index</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">index</span> <span class="p">&lt;</span> <span class="m">26</span><span class="p">;</span> <span class="p">++</span><span class="n">index</span><span class="p">)</span>
      <span class="p">{</span>
        <span class="c1">// values[index] = (numArray[index] - (index % 2 * 2 + index % 3)) ^ passwordSum;</span>
        <span class="c1">// values[index] ^ passwordSum = (numArray[index] - (index % 2 * 2 + index % 3));</span>
        <span class="n">numArray</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">^</span> <span class="n">passwordSum</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="n">index</span> <span class="p">%</span> <span class="m">2</span> <span class="p">*</span> <span class="m">2</span> <span class="p">+</span> <span class="n">index</span> <span class="p">%</span> <span class="m">3</span><span class="p">);</span>
        <span class="n">flag</span> <span class="p">+=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">numArray</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>This simple C# solution printed out the correct flag as <code class="language-plaintext highlighter-rouge">GLUG{d0tn3t_1s_qu1t3_go0d}</code>.</p><hr /><h3 id="2-childrev-reverse">2. <a id="childrev" style="text-decoration:none;">Childrev [reverse]</a></h3><p>The challenge statement:</p><blockquote><p>The baby has grown up to be very mischievous. <br /> Can you bring him under control?<br /> File: <a href="/assets/img/foobar/childrev.zip">childrev</a></p></blockquote><p>For this challenge, we received a legit <code class="language-plaintext highlighter-rouge">ELF 64-bit</code> executable file. Last time when I visit the Underworld I chickened out in a day or two. I only know that there are few powerful tools to deal with this sort of situation, but they all require a fair bit of assembler familiarity. To me, a low-level programming language is a monster under the bed that does magical things in the Underworld where I am afraid to wander. But this time around I was not alone in there. A new friend of mine, from Germany, shed some light into the darkness. He taught me just enough to find the treasure in time.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file ./childrev <span class="c"># show file information</span>
</code></pre></div></div><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>childrev: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), statically linked, ...
</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>strings childrev | <span class="nb">grep</span> <span class="s1">'GLUG\|UPX'</span> <span class="c"># search strings similar to GLUG or UPX</span>
</code></pre></div></div><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UPX!P
$Info: This file is packed with the UPX executable packer http://upx.sf.net $
$Id: UPX 3.96 Copyright (C) 1996-2020 the UPX Team. All Rights Reserved. $
UPX!u
UPX!
UPX!
</code></pre></div></div><p>The file is packed with the UPX executable packer. So we need to unpack it, to dig further.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>upx <span class="nt">-d</span> childrev <span class="c"># unpack by upx</span>
</code></pre></div></div><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                       Ultimate Packer for eXecutables
                          Copyright (C) 1996 - 2020
UPX 3.96        Markus Oberhumer, Laszlo Molnar &amp; John Reiser   Jan 23rd 2020

        File size         Ratio      Format      Name
   --------------------   ------   -----------   -----------
    910136 &lt;-    406024   44.61%   linux/amd64   childrev

Unpacked 1 file.
</code></pre></div></div><p>These days, to do reverse engineering and/or binary analysis people seem to be using: <a href="https://www.gnu.org/software/gdb/">GDB</a>, <a href="https://github.com/radareorg/radare2">radare2</a>, <a href="https://www.hex-rays.com/products/ida/ho">IDA</a>, <a href="https://www.hopperapp.com/">Hopper</a>, and <a href="https://ghidra-sre.org/">Ghidra</a>, etc. Each of them comes with its advantages/disadvantages and a learning curve. I am still trying to find my grip on some of them.</p><p>I liked the visualization that the radare2 tool provides. So let’s take a look at the <code class="language-plaintext highlighter-rouge">childrev</code> file using radare2.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>r2 ./childrev
</code></pre></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>0x00401b90]&gt; aaa <span class="c"># Analyze the file</span>
<span class="o">[</span>x] Analyze all flags starting with sym. and entry0 <span class="o">(</span>aa<span class="o">)</span>
<span class="o">[</span>x] Analyze <span class="k">function </span>calls <span class="o">(</span>aac<span class="o">)</span>
<span class="o">[</span>x] Analyze len bytes of instructions <span class="k">for </span>references <span class="o">(</span>aar<span class="o">)</span>
<span class="o">[</span>x] Check <span class="k">for </span>vtables
<span class="o">[</span>x] Type matching analysis <span class="k">for </span>all functions <span class="o">(</span>aaft<span class="o">)</span>
<span class="o">[</span>x] Propagate noreturn information
<span class="o">[</span>x] Use <span class="nt">-AA</span> or aaaa to perform additional experimental analysis.
<span class="o">[</span>0x00401b90]&gt; s main <span class="c"># seek(s) 'main' function</span>
<span class="o">[</span>0x00401e41]&gt; agv <span class="c"># visualize the function</span>
</code></pre></div></div><div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                                      <span class="err">┌─────────────────────────────────────────────────────┐</span>
                                      <span class="err">│</span>  <span class="err">0</span><span class="nf">x401e41</span>                                     <span class="err">│</span>
                                      <span class="err">│</span>   <span class="c1">; DATA XREF from entry0 @ 0x401bad                │</span>
                                      <span class="err">│</span>   <span class="c1">;-- rip:                                          │</span>
                                      <span class="err">│</span> <span class="err">171:</span> <span class="nf">int</span> <span class="nv">main</span> <span class="p">(</span><span class="nv">int</span> <span class="nv">argc</span><span class="p">,</span> <span class="nb">ch</span><span class="nv">ar</span> <span class="o">**</span><span class="nv">argv</span><span class="p">,</span> <span class="nb">ch</span><span class="nv">ar</span> <span class="o">**</span><span class="nv">envp</span><span class="p">)</span><span class="c1">; │</span>
                                      <span class="err">│</span> <span class="c1">; var int64_t var_30h @ rbp-0x30                    │</span>
                                      <span class="err">│</span> <span class="c1">; var uint32_t var_8h @ rbp-0x8                     │</span>
                                      <span class="err">│</span> <span class="c1">; var int64_t var_4h @ rbp-0x4                      │</span>
                                      <span class="err">│</span> <span class="c1">; var int64_t var_3h @ rbp-0x3                      │</span>
                                      <span class="err">│</span> <span class="c1">; var int64_t var_2h @ rbp-0x2                      │</span>
                                      <span class="err">│</span> <span class="c1">; var int64_t var_1h @ rbp-0x1                      │</span>
                                      <span class="err">│</span> <span class="nf">push</span> <span class="nb">rbp</span>                                            <span class="err">│</span>
                                      <span class="err">│</span> <span class="nf">mov</span> <span class="nb">rbp</span><span class="p">,</span> <span class="nb">rsp</span>                                        <span class="err">│</span>
                                      <span class="err">│</span> <span class="nf">sub</span> <span class="nb">rsp</span><span class="p">,</span> <span class="mh">0x30</span>                                       <span class="err">│</span>
                                      <span class="err">│</span> <span class="c1">; int64_t arg1                                      │</span>
                                      <span class="err">│</span> <span class="c1">; 0x49e170                                          │</span>
                                      <span class="err">│</span> <span class="c1">; "ENTER THE FLAG : "                               │</span>
                                      <span class="err">│</span> <span class="nf">lea</span> <span class="nb">rdi</span><span class="p">,</span> <span class="nv">str.ENTER_THE_FLAG_</span><span class="p">:</span><span class="nv">_</span>                      <span class="err">│</span>
                                      <span class="err">│</span> <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mi">0</span>                                          <span class="err">│</span>
                                      <span class="err">│</span> <span class="nf">call</span> <span class="nv">sym.__printf</span><span class="c1">;[oa]                              │</span>
                                      <span class="err">│</span> <span class="nf">lea</span> <span class="nb">rax</span><span class="p">,</span> <span class="p">[</span><span class="nv">var_30h</span><span class="p">]</span>                                  <span class="err">│</span>
                                      <span class="err">│</span> <span class="nf">mov</span> <span class="nb">rsi</span><span class="p">,</span> <span class="nb">rax</span>                                        <span class="err">│</span>
                                      <span class="err">│</span> <span class="c1">; const char *format                                │</span>
                                      <span class="err">│</span> <span class="c1">; "%s"                                              │</span>
                                      <span class="err">│</span> <span class="nf">lea</span> <span class="nb">rdi</span><span class="p">,</span> <span class="p">[</span><span class="mh">0x0049e182</span><span class="p">]</span>                               <span class="err">│</span>
                                      <span class="err">│</span> <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mi">0</span>                                          <span class="err">│</span>
                                      <span class="err">│</span> <span class="c1">; int scanf(const char *format)                     │</span>
                                      <span class="err">│</span> <span class="nf">call</span> <span class="nv">sym.__isoc99_scanf</span><span class="c1">;[ob]                        │</span>
                                      <span class="err">│</span> <span class="c1">; 'G'                                               │</span>
                                      <span class="err">│</span> <span class="c1">; 71                                                │</span>
                                      <span class="err">│</span> <span class="nf">mov</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_1h</span><span class="p">],</span> <span class="mh">0x47</span>                             <span class="err">│</span>
                                      <span class="err">│</span> <span class="c1">; 'L'                                               │</span>
                                      <span class="err">│</span> <span class="c1">; 76                                                │</span>
                                      <span class="err">│</span> <span class="nf">mov</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_2h</span><span class="p">],</span> <span class="mh">0x4c</span>                             <span class="err">│</span>
                                      <span class="err">│</span> <span class="c1">; 'U'                                               │</span>
                                      <span class="err">│</span> <span class="c1">; 85                                                │</span>
                                      <span class="err">│</span> <span class="nf">mov</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_3h</span><span class="p">],</span> <span class="mh">0x55</span>                             <span class="err">│</span>
                                      <span class="err">│</span> <span class="c1">; 'G'                                               │</span>
                                      <span class="err">│</span> <span class="c1">; 71                                                │</span>
                                      <span class="err">│</span> <span class="nf">mov</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_4h</span><span class="p">],</span> <span class="mh">0x47</span>                             <span class="err">│</span>
                                      <span class="err">│</span> <span class="nf">movsx</span> <span class="nb">edi</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_4h</span><span class="p">]</span>                            <span class="err">│</span>
                                      <span class="err">│</span> <span class="c1">; int64_t arg5                                      │</span>
                                      <span class="err">│</span> <span class="nf">movsx</span> <span class="nb">ecx</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_3h</span><span class="p">]</span>                            <span class="err">│</span>
                                      <span class="err">│</span> <span class="c1">; int64_t arg4                                      │</span>
                                      <span class="err">│</span> <span class="nf">movsx</span> <span class="nb">edx</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_2h</span><span class="p">]</span>                            <span class="err">│</span>
                                      <span class="err">│</span> <span class="c1">; int64_t arg2                                      │</span>
                                      <span class="err">│</span> <span class="nf">movsx</span> <span class="nb">esi</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_1h</span><span class="p">]</span>                            <span class="err">│</span>
                                      <span class="err">│</span> <span class="nf">lea</span> <span class="nb">rax</span><span class="p">,</span> <span class="p">[</span><span class="nv">var_30h</span><span class="p">]</span>                                  <span class="err">│</span>
                                      <span class="err">│</span> <span class="nf">mov</span> <span class="nb">r8d</span><span class="p">,</span> <span class="nb">edi</span>                                        <span class="err">│</span>
                                      <span class="err">│</span> <span class="c1">; int64_t arg1                                      │</span>
                                      <span class="err">│</span> <span class="nf">mov</span> <span class="nb">rdi</span><span class="p">,</span> <span class="nb">rax</span>                                        <span class="err">│</span>
                                      <span class="err">│</span> <span class="nf">call</span> <span class="nv">sym.XOR</span><span class="c1">;[oc]                                   │</span>
                                      <span class="err">│</span> <span class="nf">mov</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_8h</span><span class="p">],</span> <span class="nb">eax</span>                             <span class="err">│</span>
                                      <span class="err">│</span> <span class="nf">cmp</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_8h</span><span class="p">],</span> <span class="mi">0</span>                               <span class="err">│</span>
                                      <span class="err">│</span> <span class="nf">jne</span> <span class="mh">0x401eb8</span>                                        <span class="err">│</span>
                                      <span class="err">└─────────────────────────────────────────────────────┘</span>
                                              <span class="nf">f</span> <span class="nv">t</span>
                                              <span class="err">│</span> <span class="err">│</span>
                                              <span class="err">│</span> <span class="err">└───────────────────────────┐</span>
    <span class="err">┌─────────────────────────────────────────┘</span>                             <span class="err">│</span>
    <span class="err">│</span>                                                                       <span class="err">│</span>
<span class="err">┌───────────────────────────────────────────────────────────────────┐</span>   <span class="err">┌──────────────────────────────────────────────┐</span>
<span class="err">│</span>  <span class="err">0</span><span class="nf">x401eaa</span>                                                         <span class="err">│</span>   <span class="err">│</span>  <span class="mh">0x401eb8</span>                                    <span class="err">│</span>
<span class="err">│</span> <span class="c1">; const char *s                                                   │   │ ; CODE XREF from main @ 0x401ea8             │</span>
<span class="err">│</span> <span class="c1">; 0x49e188                                                        │   │ movsx esi, byte [var_4h]                     │</span>
<span class="err">│</span> <span class="c1">; "USE GHIDRA CUTTER OR IDA , THEN IT WILL BE EASY\n"             │   │ ; int64_t arg4                               │</span>
<span class="err">│</span> <span class="nf">lea</span> <span class="nb">rdi</span><span class="p">,</span> <span class="nv">str.USE_GHIDRA_CUTTER_OR_IDA___THEN_IT_WILL_BE_EASY_n</span>    <span class="err">│</span>   <span class="err">│</span> <span class="nv">movsx</span> <span class="nb">ecx</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_3h</span><span class="p">]</span>                     <span class="err">│</span>
<span class="err">│</span> <span class="c1">; int puts(const char *s)                                         │   │ ; int64_t arg3                               │</span>
<span class="err">│</span> <span class="nf">call</span> <span class="nv">sym.puts</span><span class="c1">;[od]                                                │   │ movsx edx, byte [var_2h]                     │</span>
<span class="err">│</span> <span class="nf">jmp</span> <span class="mh">0x401ee5</span>                                                      <span class="err">│</span>   <span class="err">│</span> <span class="nv">movsx</span> <span class="nb">eax</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_1h</span><span class="p">]</span>                     <span class="err">│</span>
<span class="err">└───────────────────────────────────────────────────────────────────┘</span>   <span class="err">│</span> <span class="nf">lea</span> <span class="nb">rdi</span><span class="p">,</span> <span class="p">[</span><span class="nv">var_30h</span><span class="p">]</span>                           <span class="err">│</span>
    <span class="nf">v</span>                                                                   <span class="err">│</span> <span class="c1">; int64_t arg6                               │</span>
    <span class="err">│</span>                                                                   <span class="err">│</span> <span class="nf">mov</span> <span class="nv">r9</span><span class="p">,</span> <span class="nb">rdi</span>                                  <span class="err">│</span>
    <span class="err">│</span>                                                                   <span class="err">│</span> <span class="c1">; int64_t arg5                               │</span>
    <span class="err">│</span>                                                                   <span class="err">│</span> <span class="nf">mov</span> <span class="nb">r8d</span><span class="p">,</span> <span class="nb">esi</span>                                 <span class="err">│</span>
    <span class="err">│</span>                                                                   <span class="err">│</span> <span class="c1">; int64_t arg2                               │</span>
    <span class="err">│</span>                                                                   <span class="err">│</span> <span class="nf">mov</span> <span class="nb">esi</span><span class="p">,</span> <span class="nb">eax</span>                                 <span class="err">│</span>
    <span class="err">│</span>                                                                   <span class="err">│</span> <span class="c1">; int64_t arg1                               │</span>
    <span class="err">│</span>                                                                   <span class="err">│</span> <span class="c1">; 0x49e1b9                                   │</span>
    <span class="err">│</span>                                                                   <span class="err">│</span> <span class="c1">; "YAY U MADE IT \n%c%c%c%c{%s}\n"           │</span>
    <span class="err">│</span>                                                                   <span class="err">│</span> <span class="nf">lea</span> <span class="nb">rdi</span><span class="p">,</span> <span class="nv">str.YAY_U_MADE_IT__n_c_c_c_c_s_n</span>    <span class="err">│</span>
    <span class="err">│</span>                                                                   <span class="err">│</span> <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mi">0</span>                                   <span class="err">│</span>
    <span class="err">│</span>                                                                   <span class="err">│</span> <span class="nf">call</span> <span class="nv">sym.__printf</span><span class="c1">;[oa]                       │</span>
    <span class="err">│</span>                                                                   <span class="err">└──────────────────────────────────────────────┘</span>
    <span class="err">│</span>                                                                       <span class="nf">v</span>
    <span class="err">│</span>                                                                       <span class="err">│</span>
    <span class="err">└────────────────────────────────────────────────┐</span>                      <span class="err">│</span>
                                                     <span class="err">│</span> <span class="err">┌────────────────────┘</span>
                                                     <span class="err">│</span> <span class="err">│</span>
                                               <span class="err">┌──────────────────────────────────┐</span>
                                               <span class="err">│</span>  <span class="err">0</span><span class="nf">x401ee5</span>                        <span class="err">│</span>
                                               <span class="err">│</span> <span class="c1">; CODE XREF from main @ 0x401eb6 │</span>
                                               <span class="err">│</span> <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="mi">0</span>                       <span class="err">│</span>
                                               <span class="err">│</span> <span class="nf">leave</span>                            <span class="err">│</span>
                                               <span class="err">│</span> <span class="nf">ret</span>                              <span class="err">│</span>
                                               <span class="err">└──────────────────────────────────┘</span>
</code></pre></div></div><p>This main function has 4 blocks with starting addresses of <code class="language-plaintext highlighter-rouge">0x401e41</code>, <code class="language-plaintext highlighter-rouge">0x401eaa</code>, <code class="language-plaintext highlighter-rouge">0x401eb8</code> and <code class="language-plaintext highlighter-rouge">0x401ee5</code>. The first and last blocks are always executed but the execution of the second or third is conditionally dependent on the first block’s execution. Judging by the content of the second and third blocks, I prefer to go with the third. Let’s take a closer look at what happens near the end of the first block.</p><div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">call</span> <span class="nv">sym.XOR</span><span class="c1">;[oc]         ; calling sym.XOR function </span>
<span class="nf">mov</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_8h</span><span class="p">],</span> <span class="nb">eax</span>   <span class="c1">; moving the output of sym.XOR function to var_8h variable</span>
<span class="nf">cmp</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_8h</span><span class="p">],</span> <span class="mi">0</span>     <span class="c1">; comparing value of the var_8h variable with 0</span>
<span class="nf">jne</span> <span class="mh">0x401eb8</span>              <span class="c1">; jumping if they were not equal.</span>
</code></pre></div></div><p>Here, I commented on the ASM instructions with my baby-educated guesses. So I want the <code class="language-plaintext highlighter-rouge">sym.XOR</code> output not to be 0. Let’s see the <code class="language-plaintext highlighter-rouge">sym.XOR</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>0x00401e41]&gt; s sym.XOR
<span class="o">[</span>0x00401d3d]&gt; agv
</code></pre></div></div><div class="language-nasm highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">┌────────────────────────────────────────────────────────────────────────┐</span>
 <span class="err">│</span>  <span class="err">0</span><span class="nf">x401d3d</span>                                                              <span class="err">│</span>
 <span class="err">│</span>   <span class="c1">; CALL XREF from main @ 0x401e9c                                     │</span>
 <span class="err">│</span> <span class="err">260:</span> <span class="nf">sym.XOR</span> <span class="p">(</span><span class="nv">int64_t</span> <span class="nv">arg1</span><span class="p">,</span> <span class="nv">int64_t</span> <span class="nv">arg2</span><span class="p">,</span> <span class="nv">int64_t</span> <span class="nv">arg4</span><span class="p">,</span> <span class="nv">int64_t</span> <span class="nv">arg5</span><span class="p">)</span><span class="c1">; │</span>
 <span class="err">│</span> <span class="c1">; var int64_t var_258h @ rbp-0x258                                     │</span>
 <span class="err">│</span> <span class="c1">; var int64_t var_254h @ rbp-0x254                                     │</span>
 <span class="err">│</span> <span class="c1">; var int64_t var_250h @ rbp-0x250                                     │</span>
 <span class="err">│</span> <span class="c1">; var int64_t var_24ch @ rbp-0x24c                                     │</span>
 <span class="err">│</span> <span class="c1">; var int64_t var_248h @ rbp-0x248                                     │</span>
 <span class="err">│</span> <span class="c1">; var int64_t var_240h @ rbp-0x240                                     │</span>
 <span class="err">│</span> <span class="c1">; var int64_t var_130h @ rbp-0x130                                     │</span>
 <span class="err">│</span> <span class="c1">; var int64_t var_18h @ rbp-0x18                                       │</span>
 <span class="err">│</span> <span class="c1">; var signed int64_t var_ch @ rbp-0xc                                  │</span>
 <span class="err">│</span> <span class="c1">; var int64_t var_8h @ rbp-0x8                                         │</span>
 <span class="err">│</span> <span class="c1">; var signed int64_t var_4h @ rbp-0x4                                  │</span>
 <span class="err">│</span> <span class="c1">; arg int64_t arg1 @ rdi                                               │</span>
 <span class="err">│</span> <span class="c1">; arg int64_t arg2 @ rsi                                               │</span>
 <span class="err">│</span> <span class="c1">; arg int64_t arg4 @ rcx                                               │</span>
 <span class="err">│</span> <span class="c1">; arg int64_t arg5 @ r8                                                │</span>
 <span class="err">│</span> <span class="nf">push</span> <span class="nb">rbp</span>                                                               <span class="err">│</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="nb">rbp</span><span class="p">,</span> <span class="nb">rsp</span>                                                           <span class="err">│</span>
 <span class="err">│</span> <span class="nf">sub</span> <span class="nb">rsp</span><span class="p">,</span> <span class="mh">0x260</span>                                                         <span class="err">│</span>
 <span class="err">│</span> <span class="c1">; arg1                                                                 │</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="kt">qword</span> <span class="p">[</span><span class="nv">var_248h</span><span class="p">],</span> <span class="nb">rdi</span>                                              <span class="err">│</span>
 <span class="err">│</span> <span class="c1">; arg4                                                                 │</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="nb">ecx</span>                                                           <span class="err">│</span>
 <span class="err">│</span> <span class="c1">; arg5                                                                 │</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="nb">edi</span><span class="p">,</span> <span class="nb">r8d</span>                                                           <span class="err">│</span>
 <span class="err">│</span> <span class="c1">; arg2                                                                 │</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esi</span>                                                           <span class="err">│</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_24ch</span><span class="p">],</span> <span class="nb">cl</span>                                                <span class="err">│</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_250h</span><span class="p">],</span> <span class="nb">dl</span>                                                <span class="err">│</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_254h</span><span class="p">],</span> <span class="nb">al</span>                                                <span class="err">│</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="nb">edi</span>                                                           <span class="err">│</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_258h</span><span class="p">],</span> <span class="nb">al</span>                                                <span class="err">│</span>
 <span class="err">│</span> <span class="nf">movsx</span> <span class="nb">ecx</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_258h</span><span class="p">]</span>                                             <span class="err">│</span>
 <span class="err">│</span> <span class="nf">movsx</span> <span class="nb">edx</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_254h</span><span class="p">]</span>                                             <span class="err">│</span>
 <span class="err">│</span> <span class="nf">movsx</span> <span class="nb">esi</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_250h</span><span class="p">]</span>                                             <span class="err">│</span>
 <span class="err">│</span> <span class="nf">movsx</span> <span class="nb">eax</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nv">var_24ch</span><span class="p">]</span>                                             <span class="err">│</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="nb">edi</span><span class="p">,</span> <span class="nb">eax</span>                                                           <span class="err">│</span>
 <span class="err">│</span> <span class="nf">call</span> <span class="nv">sym.gen_key</span><span class="c1">;[oa]                                                  │</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="kt">qword</span> <span class="p">[</span><span class="nv">var_18h</span><span class="p">],</span> <span class="nb">rax</span>                                               <span class="err">│</span>
 <span class="err">│</span> <span class="nf">mov</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_4h</span><span class="p">],</span> <span class="mi">0</span>                                                  <span class="err">│</span>
 <span class="err">│</span> <span class="nf">jmp</span> <span class="mh">0x401dcf</span>                                                           <span class="err">│</span>
 <span class="err">└────────────────────────────────────────────────────────────────────────┘</span>
     <span class="nf">v</span>
     <span class="err">│</span>
     <span class="err">└───────────────────┐</span>
<span class="err">┌──────────────────────────┐</span>
<span class="err">│</span>                        <span class="err">│</span> <span class="err">│</span>
<span class="err">│</span>                  <span class="err">┌─────────────────────────────────────┐</span>
<span class="err">│</span>                  <span class="err">│</span>  <span class="err">0</span><span class="nf">x401dcf</span>                           <span class="err">│</span>
<span class="err">│</span>                  <span class="err">│</span> <span class="c1">; CODE XREF from sym.XOR @ 0x401d9e │</span>
<span class="err">│</span>                  <span class="err">│</span> <span class="nf">cmp</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_4h</span><span class="p">],</span> <span class="mh">0x21</span>            <span class="err">│</span>
<span class="err">│</span>                  <span class="err">│</span> <span class="nf">jle</span> <span class="mh">0x401da0</span>                        <span class="err">│</span>
<span class="err">│</span>                  <span class="err">└─────────────────────────────────────┘</span>
<span class="err">│</span>                        <span class="nf">t</span> <span class="nv">f</span>
<span class="err">│</span>                        <span class="err">│</span> <span class="err">│</span>
<span class="err">│</span>    <span class="err">┌───────────────────┘</span> <span class="err">│</span>
<span class="err">│</span>    <span class="err">│</span>                     <span class="err">└───────────────────────┐</span>
<span class="err">│</span>    <span class="err">│</span>                                             <span class="err">│</span>
<span class="err">│┌─────────────────────────────────────────┐</span>   <span class="err">┌───────────────────────────────────────────┐</span>
<span class="err">││</span>  <span class="err">0</span><span class="nf">x401da0</span>                               <span class="err">│</span>   <span class="err">│</span>  <span class="mh">0x401dd5</span>                                 <span class="err">│</span>
<span class="err">││</span> <span class="c1">; CODE XREF from sym.XOR @ 0x401dd3     │   │ lea rax, [var_240h]                       │</span>
<span class="err">││</span> <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_4h</span><span class="p">]</span>                 <span class="err">│</span>   <span class="err">│</span> <span class="nv">lea</span> <span class="nb">rdx</span><span class="p">,</span> <span class="p">[</span><span class="mh">0x0049e060</span><span class="p">]</span>                     <span class="err">│</span>
<span class="err">││</span> <span class="nf">movsxd</span> <span class="nb">rdx</span><span class="p">,</span> <span class="nb">eax</span>                         <span class="err">│</span>   <span class="err">│</span> <span class="c1">; '"'                                     │</span>
<span class="err">││</span> <span class="nf">mov</span> <span class="nb">rax</span><span class="p">,</span> <span class="kt">qword</span> <span class="p">[</span><span class="nv">var_248h</span><span class="p">]</span>               <span class="err">│</span>   <span class="err">│</span> <span class="c1">; 34                                      │</span>
<span class="err">││</span> <span class="nf">add</span> <span class="nb">rax</span><span class="p">,</span> <span class="nb">rdx</span>                            <span class="err">│</span>   <span class="err">│</span> <span class="nv">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="mh">0x22</span>                             <span class="err">│</span>
<span class="err">││</span> <span class="nf">movzx</span> <span class="nb">eax</span><span class="p">,</span> <span class="kt">byte</span> <span class="p">[</span><span class="nb">rax</span><span class="p">]</span>                   <span class="err">│</span>   <span class="err">│</span> <span class="nv">mov</span> <span class="nb">rdi</span><span class="p">,</span> <span class="nb">rax</span>                              <span class="err">│</span>
<span class="err">││</span> <span class="nf">movsx</span> <span class="nb">rax</span><span class="p">,</span> <span class="nb">al</span>                           <span class="err">│</span>   <span class="err">│</span> <span class="nv">mov</span> <span class="nb">rsi</span><span class="p">,</span> <span class="nb">rdx</span>                              <span class="err">│</span>
<span class="err">││</span> <span class="nf">xor</span> <span class="nb">rax</span><span class="p">,</span> <span class="kt">qword</span> <span class="p">[</span><span class="nv">var_18h</span><span class="p">]</span>                <span class="err">│</span>   <span class="err">│</span> <span class="nv">rep</span> <span class="nv">movsq</span> <span class="kt">qword</span> <span class="p">[</span><span class="nb">rdi</span><span class="p">],</span> <span class="kt">qword</span> <span class="nv">ptr</span> <span class="p">[</span><span class="nb">rsi</span><span class="p">]</span>    <span class="err">│</span>
<span class="err">││</span> <span class="nf">mov</span> <span class="nb">rdx</span><span class="p">,</span> <span class="nb">rax</span>                            <span class="err">│</span>   <span class="err">│</span> <span class="nv">mov</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_8h</span><span class="p">],</span> <span class="mi">0</span>                     <span class="err">│</span>
<span class="err">││</span> <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_4h</span><span class="p">]</span>                 <span class="err">│</span>   <span class="err">│</span> <span class="nv">mov</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_ch</span><span class="p">],</span> <span class="mi">0</span>                     <span class="err">│</span>
<span class="err">││</span> <span class="nf">cdqe</span>                                    <span class="err">│</span>   <span class="err">│</span> <span class="nv">jmp</span> <span class="mh">0x401e36</span>                              <span class="err">│</span>
<span class="err">││</span> <span class="nf">mov</span> <span class="kt">qword</span> <span class="p">[</span><span class="nb">rbp</span> <span class="o">+</span> <span class="nb">rax</span><span class="o">*</span><span class="mi">8</span> <span class="o">-</span> <span class="mh">0x130</span><span class="p">],</span> <span class="nb">rdx</span>    <span class="err">│</span>   <span class="err">└───────────────────────────────────────────┘</span>
<span class="err">││</span> <span class="nf">add</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_4h</span><span class="p">],</span> <span class="mi">1</span>                   <span class="err">│</span>       <span class="nv">v</span>
<span class="err">│└─────────────────────────────────────────┘</span>       <span class="err">│</span>
<span class="err">│</span>    <span class="nf">v</span>                                             <span class="err">│</span>
<span class="err">│</span>    <span class="err">│</span>                                             <span class="err">│</span>
<span class="err">└────┘</span>                                             <span class="err">│</span>
                                                   <span class="err">└────────┐</span>
                <span class="err">┌─────────────────────────────────────────────┐</span>
                <span class="err">│</span>                                           <span class="err">│</span> <span class="err">│</span>
                <span class="err">│</span>                                     <span class="err">┌─────────────────────────────────────┐</span>
                <span class="err">│</span>                                     <span class="err">│</span>  <span class="err">0</span><span class="nf">x401e36</span>                           <span class="err">│</span>
                <span class="err">│</span>                                     <span class="err">│</span> <span class="c1">; CODE XREF from sym.XOR @ 0x401dff │</span>
                <span class="err">│</span>                                     <span class="err">│</span> <span class="nf">cmp</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_ch</span><span class="p">],</span> <span class="mh">0x21</span>            <span class="err">│</span>
                <span class="err">│</span>                                     <span class="err">│</span> <span class="nf">jle</span> <span class="mh">0x401e01</span>                        <span class="err">│</span>
                <span class="err">│</span>                                     <span class="err">└─────────────────────────────────────┘</span>
                <span class="err">│</span>                                           <span class="nf">t</span> <span class="nv">f</span>
                <span class="err">│</span>                                           <span class="err">│</span> <span class="err">│</span>
                <span class="err">│</span>    <span class="err">┌──────────────────────────────────────┘</span> <span class="err">│</span>
                <span class="err">│</span>    <span class="err">│</span>                                        <span class="err">└──────────────────────────────────────────────┐</span>
                <span class="err">│</span>    <span class="err">│</span>                                                                                       <span class="err">│</span>
                <span class="err">│┌─────────────────────────────────────────┐</span>                                                 <span class="err">│</span>
                <span class="err">││</span>  <span class="err">0</span><span class="nf">x401e01</span>                               <span class="err">│</span>                                                 <span class="err">│</span>
                <span class="err">││</span> <span class="c1">; CODE XREF from sym.XOR @ 0x401e3a     │                                                 │</span>
                <span class="err">││</span> <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_ch</span><span class="p">]</span>                 <span class="err">│</span>                                                 <span class="err">│</span>
                <span class="err">││</span> <span class="nf">cdqe</span>                                    <span class="err">│</span>                                                 <span class="err">│</span>
                <span class="err">││</span> <span class="nf">mov</span> <span class="nb">rdx</span><span class="p">,</span> <span class="kt">qword</span> <span class="p">[</span><span class="nb">rbp</span> <span class="o">+</span> <span class="nb">rax</span><span class="o">*</span><span class="mi">8</span> <span class="o">-</span> <span class="mh">0x130</span><span class="p">]</span>    <span class="err">│</span>                                                 <span class="err">│</span>
                <span class="err">││</span> <span class="nf">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_ch</span><span class="p">]</span>                 <span class="err">│</span>                                                 <span class="err">│</span>
                <span class="err">││</span> <span class="nf">cdqe</span>                                    <span class="err">│</span>                                                 <span class="err">│</span>
                <span class="err">││</span> <span class="nf">mov</span> <span class="nb">rax</span><span class="p">,</span> <span class="kt">qword</span> <span class="p">[</span><span class="nb">rbp</span> <span class="o">+</span> <span class="nb">rax</span><span class="o">*</span><span class="mi">8</span> <span class="o">-</span> <span class="mh">0x240</span><span class="p">]</span>    <span class="err">│</span>                                                 <span class="err">│</span>
                <span class="err">││</span> <span class="nf">cmp</span> <span class="nb">rdx</span><span class="p">,</span> <span class="nb">rax</span>                            <span class="err">│</span>                                                 <span class="err">│</span>
                <span class="err">││</span> <span class="nf">jne</span> <span class="mh">0x401e29</span>                            <span class="err">│</span>                                                 <span class="err">│</span>
                <span class="err">│└─────────────────────────────────────────┘</span>                                                 <span class="err">│</span>
                <span class="err">│</span>        <span class="nf">f</span> <span class="nv">t</span>                                                                                 <span class="err">│</span>
                <span class="err">│</span>        <span class="err">│</span> <span class="err">│</span>                                                                                 <span class="err">│</span>
                <span class="err">│</span>        <span class="err">│</span> <span class="err">└───────────────────────────────────────────┐</span>                                     <span class="err">│</span>
                <span class="err">│</span>        <span class="err">└──┐</span>                                          <span class="err">│</span>                                     <span class="err">│</span>
                <span class="err">│</span>           <span class="err">│</span>                                          <span class="err">│</span>                                     <span class="err">│</span>
                <span class="err">│</span>       <span class="err">┌──────────────────────────┐</span>               <span class="err">┌─────────────────────────────────────┐</span>   <span class="err">│</span>
                <span class="err">│</span>       <span class="err">│</span>  <span class="err">0</span><span class="nf">x401e20</span>                <span class="err">│</span>               <span class="err">│</span>  <span class="mh">0x401e29</span>                           <span class="err">│</span>   <span class="err">│</span>
                <span class="err">│</span>       <span class="err">│</span> <span class="nf">mov</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_8h</span><span class="p">],</span> <span class="mi">1</span>    <span class="err">│</span>               <span class="err">│</span> <span class="c1">; CODE XREF from sym.XOR @ 0x401e1e │   │</span>
                <span class="err">│</span>       <span class="err">│</span> <span class="nf">jmp</span> <span class="mh">0x401e32</span>             <span class="err">│</span>               <span class="err">│</span> <span class="nv">mov</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_8h</span><span class="p">],</span> <span class="mi">0</span>               <span class="err">│</span>   <span class="err">│</span>
                <span class="err">│</span>       <span class="err">└──────────────────────────┘</span>               <span class="err">│</span> <span class="nf">jmp</span> <span class="mh">0x401e3c</span>                        <span class="err">│</span>   <span class="err">│</span>
                <span class="err">│</span>           <span class="nf">v</span>                                      <span class="err">└─────────────────────────────────────┘</span>   <span class="err">│</span>
                <span class="err">│</span>           <span class="err">│</span>                                          <span class="nf">v</span>                                     <span class="err">│</span>
                <span class="err">│</span>           <span class="err">│</span>                                          <span class="err">│</span>                                     <span class="err">│</span>
                <span class="err">│</span>      <span class="err">┌────┘</span>                                          <span class="err">│</span>                                     <span class="err">│</span>
                <span class="err">│</span>      <span class="err">│</span>                                               <span class="err">└────────────┐</span>                        <span class="err">│</span>
                <span class="err">│</span>      <span class="err">│</span>                                                            <span class="err">│</span> <span class="err">┌──────────────────────┘</span>
                <span class="err">│</span>      <span class="err">│</span>                                                            <span class="err">│</span> <span class="err">│</span>
                <span class="err">│</span>  <span class="err">┌─────────────────────────────────────┐</span>                    <span class="err">┌─────────────────────────────────────┐</span>
                <span class="err">│</span>  <span class="err">│</span>  <span class="err">0</span><span class="nf">x401e32</span>                           <span class="err">│</span>                    <span class="err">│</span>  <span class="mh">0x401e3c</span>                           <span class="err">│</span>
                <span class="err">│</span>  <span class="err">│</span> <span class="c1">; CODE XREF from sym.XOR @ 0x401e27 │                    │ ; CODE XREF from sym.XOR @ 0x401e30 │</span>
                <span class="err">│</span>  <span class="err">│</span> <span class="nf">add</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_ch</span><span class="p">],</span> <span class="mi">1</span>               <span class="err">│</span>                    <span class="err">│</span> <span class="nv">mov</span> <span class="nb">eax</span><span class="p">,</span> <span class="kt">dword</span> <span class="p">[</span><span class="nv">var_8h</span><span class="p">]</span>             <span class="err">│</span>
                <span class="err">│</span>  <span class="err">└─────────────────────────────────────┘</span>                    <span class="err">│</span> <span class="nf">leave</span>                               <span class="err">│</span>
                <span class="err">│</span>      <span class="nf">v</span>                                                      <span class="err">│</span> <span class="nv">ret</span>                                 <span class="err">│</span>
                <span class="err">│</span>      <span class="err">│</span>                                                      <span class="err">└─────────────────────────────────────┘</span>
                <span class="err">│</span>      <span class="err">│</span>
                <span class="err">│</span>      <span class="err">│</span>
                <span class="err">└──────┘</span>
</code></pre></div></div><p>We can see that our exit block is <code class="language-plaintext highlighter-rouge">0x401e3c</code> in the bottom right corner. Just above it, the block <code class="language-plaintext highlighter-rouge">0x401e29</code> is trying to give us 0. So no go. Looking only at the bottom 6 blocks, we can conclude that it is a loop structure where it compares some values 33 (0x21) times.</p><blockquote><p>if any one of the 33 comparisons fails then we get 0.<br /> if all the comparisons pass then we might get something other than 0.</p></blockquote><p>So now our focus shifts to the values being compared. To look up the actual values that are being compared:</p><ol><li>Open up the <code class="language-plaintext highlighter-rouge">childrev</code> file in IDA.</li><li>Locate the <code class="language-plaintext highlighter-rouge">XOR</code> function. (filter functions)</li><li>Set breakpoint in the comparison line (F2 on <code class="language-plaintext highlighter-rouge">cmp rdx, rax</code>).</li><li>Reverse the <code class="language-plaintext highlighter-rouge">jne 0x401e29</code> operation. (75 =&gt; 74 edit in hex view &amp; apply patches to the input file).</li><li>Look up the <code class="language-plaintext highlighter-rouge">rdx</code> and <code class="language-plaintext highlighter-rouge">rax</code> register values while debugging.</li></ol><p>After 33 step-over button clicks, we recovered the flag string to be <code class="language-plaintext highlighter-rouge">GLUG{x0r_and_l0g1c@l_sh1ft_e@sy_r1gh8??}</code>. I am sure that there are more elegant or straightforward ways to get it. But I am not there yet. Perhaps, I need to play more <a href="https://en.wikipedia.org/wiki/Shenzhen_I/O">SHENZHEN I/O</a> from Zachtronics.</p><hr /><p>     </p><p>Thanks to those who organized and sponsored the event, my hours spent on it were well worth it.</p><span class="meta"><time datetime="2021-04-02T00:00:00+00:00">April 2, 2021</time> &middot; <a href="/tag/CTF">CTF</a>, <a href="/tag/C# decompiler">C# decompiler</a>, <a href="/tag/reverse engineering">reverse engineering</a></span></section></main></body></html>
